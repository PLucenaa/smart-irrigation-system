name: ğŸ§ª Test SSH Connection

on:
  workflow_dispatch:  # Permite execuÃ§Ã£o manual

jobs:
  test-ssh:
    name: ğŸ” Testar ConexÃ£o SSH
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Configurar SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.VPS_SSH_PRIVATE_KEY }}

      - name: ğŸ” Testar conexÃ£o
        env:
          VPS_HOST: ${{ secrets.VPS_HOST }}
          VPS_USER: ${{ secrets.VPS_USER }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” Teste de ConexÃ£o SSH"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¡ IP de origem do GitHub Actions:"
          curl -s https://api.ipify.org
          echo ""
          echo ""
          echo "ğŸ”‘ Testando SSH com verbose..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          ssh -vvv \
              -o StrictHostKeyChecking=no \
              -o ConnectTimeout=30 \
              -o ServerAliveInterval=10 \
              -o ServerAliveCountMax=3 \
              $VPS_USER@$VPS_HOST << 'ENDSSH'
            echo "âœ… ConexÃ£o SSH estabelecida com sucesso!"
            echo "ğŸ–¥ï¸  Hostname: $(hostname)"
            echo "ğŸ“… Data: $(date)"
            echo "ğŸ‘¤ UsuÃ¡rio: $(whoami)"
            echo "ğŸ“ DiretÃ³rio atual: $(pwd)"
          ENDSSH
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Teste concluÃ­do!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"